{% extends "base.html" %}

{% block title %}{{ media.title or media.name }} - FlixTracker{% endblock %}

{% block content %}
<!-- Loading Overlay -->
<div id="loadingOverlay" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(15, 23, 42, 0.95);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    backdrop-filter: blur(10px);
">
    <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
    </div>
    <h3 style="color: var(--primary-color); font-family: 'Orbitron', monospace; margin-top: 20px;">Loading FlixTracker...</h3>
    <p style="color: var(--text-secondary);">Fetching content details</p>
</div>

<!-- Hero Section with Backdrop -->
{% if media.backdrop_path %}
<div class="hero-section mb-4" style="
    background: linear-gradient(rgba(10,10,15,0.7), rgba(10,10,15,0.7)), 
                url('https://image.tmdb.org/t/p/w1280{{ media.backdrop_path }}');
    background-size: cover;
    background-position: center;
    border-radius: 25px;
    padding: 60px 40px;
    color: white;
    border: 3px solid var(--primary-color);
    box-shadow: var(--neon-glow);
    position: relative;
    overflow: hidden;
">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1 class="display-4 fw-bold mb-2 glow-text" style="font-family: 'Orbitron', monospace;">{{ media.title or media.name }}</h1>
            {% if media.original_title and media.original_title != (media.title or media.name) %}
                <h3 class="mb-3" style="color: var(--text-secondary); font-weight: 500;">{{ media.original_title }}</h3>
            {% endif %}
            <p class="lead mb-0" style="color: var(--text-primary); font-weight: 600;">
                ({{ (media.release_date or media.first_air_date or '')[:4] }}) ‚Ä¢ 
                {% for genre in media.genres[:3] %}{{ genre.name }}{% if not loop.last %} ‚Ä¢ {% endif %}{% endfor %}
            </p>
        </div>
        <div class="col-md-4 text-end">
            <!-- Social sharing buttons -->
            <div class="social-share">
                <button class="social-btn twitter" onclick="shareContent('twitter')" title="Share on Twitter">
                    <i class="fab fa-twitter"></i>
                </button>
                <button class="social-btn facebook" onclick="shareContent('facebook')" title="Share on Facebook">
                    <i class="fab fa-facebook-f"></i>
                </button>
                <button class="social-btn whatsapp" onclick="shareContent('whatsapp')" title="Share on WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </button>
                <button class="social-btn telegram" onclick="shareContent('telegram')" title="Share on Telegram">
                    <i class="fab fa-telegram-plane"></i>
                </button>
                <button class="social-btn copy" onclick="copyLink()" title="Copy Link">
                    <i class="fas fa-link"></i>
                </button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Main Content -->
<div class="row">
    <!-- Left Column - Poster and Actions -->
    <div class="col-lg-3 col-md-4 mb-4">
        <div class="card card-custom">
            <div class="poster-container">
                {% if media.poster_path %}
                    <img src="https://image.tmdb.org/t/p/w500{{ media.poster_path }}" 
                         alt="{{ media.title or media.name }}" class="card-img-top">
                {% else %}
                    <div class="d-flex align-items-center justify-content-center bg-secondary text-white" 
                         style="height: 600px;">
                        <i class="fas fa-film fa-5x"></i>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- STREAMING PLATFORMS -->
        <div class="card card-custom mt-3">
            <div class="card-header">
                <h5 class="mb-0 glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üì∫ WHERE TO WATCH</h5>
            </div>
            <div class="card-body">
                {% if watch_providers %}
                    {% if watch_providers.get('flatrate') %}
                        <h6 style="color: var(--accent-color); margin-bottom: 10px;">üé¨ Streaming:</h6>
                        <div class="streaming-providers mb-3">
                            {% for provider in watch_providers.flatrate[:6] %}
                                <div class="provider-item" title="{{ provider.provider_name }}">
                                    <img src="https://image.tmdb.org/t/p/w92{{ provider.logo_path }}" 
                                         alt="{{ provider.provider_name }}" class="provider-logo">
                                    <span class="provider-name">{{ provider.provider_name }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    {% if watch_providers.get('rent') %}
                        <h6 style="color: var(--warning-color); margin-bottom: 10px;">üí∞ Rent:</h6>
                        <div class="streaming-providers mb-3">
                            {% for provider in watch_providers.rent[:4] %}
                                <div class="provider-item" title="{{ provider.provider_name }}">
                                    <img src="https://image.tmdb.org/t/p/w92{{ provider.logo_path }}" 
                                         alt="{{ provider.provider_name }}" class="provider-logo">
                                    <span class="provider-name">{{ provider.provider_name }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    {% if watch_providers.get('buy') %}
                        <h6 style="color: var(--primary-color); margin-bottom: 10px;">üõí Buy:</h6>
                        <div class="streaming-providers mb-3">
                            {% for provider in watch_providers.buy[:4] %}
                                <div class="provider-item" title="{{ provider.provider_name }}">
                                    <img src="https://image.tmdb.org/t/p/w92{{ provider.logo_path }}" 
                                         alt="{{ provider.provider_name }}" class="provider-logo">
                                    <span class="provider-name">{{ provider.provider_name }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-3">
                        <i class="fas fa-tv fa-3x mb-3" style="color: var(--text-muted);"></i>
                        <p style="color: var(--text-muted);">Streaming availability not found</p>
                        <small style="color: var(--text-muted);">Check your local streaming services</small>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Quick Actions with working functionality -->
        <div class="card card-custom mt-3">
            <div class="card-header">
                <h5 class="mb-0" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üìù QUICK ADD</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-3">
                    <button class="btn btn-outline-primary quick-add-btn" onclick="quickAddToList('want_to_watch', this)" 
                            data-original-text="‚≠ê WANT TO WATCH">
                        <i class="fas fa-star me-2"></i>WANT TO WATCH
                    </button>
                    <button class="btn btn-outline-info quick-add-btn" onclick="quickAddToList('watching', this)"
                            data-original-text="üì∫ CURRENTLY WATCHING">
                        <i class="fas fa-play me-2"></i>CURRENTLY WATCHING
                    </button>
                    <button class="btn btn-outline-success quick-add-btn" onclick="quickAddToList('completed', this)"
                            data-original-text="‚úÖ COMPLETED">
                        <i class="fas fa-check me-2"></i>COMPLETED
                    </button>
                    <button class="btn btn-outline-danger quick-add-btn" onclick="quickAddToList('favorites', this)"
                            data-original-text="üíñ FAVORITES">
                        <i class="fas fa-heart me-2"></i>FAVORITES
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Right Column - Details -->
    <div class="col-lg-9 col-md-8">
        <div class="card card-custom">
            <div class="card-body">
                <h2 class="card-title glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üìñ OVERVIEW</h2>
                
                <!-- Basic Info -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="text-center">
                            <h4 class="mb-1" style="color: var(--primary-color); font-size: 1.8rem; font-family: 'Orbitron', monospace;">
                                {{ "%.1f"|format(media.vote_average or 0) }}/10
                            </h4>
                            <p class="mb-0" style="color: var(--text-primary); font-size: 0.9rem; font-weight: 600;">‚≠ê TMDb Score</p>
                            <small style="color: var(--text-muted); font-size: 0.8rem;">({{ "{:,}".format(media.vote_count or 0) }} votes)</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h4 class="mb-1" style="color: var(--secondary-color); font-size: 1.8rem; font-family: 'Orbitron', monospace;">{{ "{:.0f}".format(media.popularity or 0) }}</h4>
                            <p class="mb-0" style="color: var(--text-primary); font-size: 0.9rem; font-weight: 600;">üìä Popularity</p>
                            <small style="color: var(--text-muted); font-size: 0.8rem;">Current Score</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            {% if media.media_type == 'movie' and media.runtime %}
                                <h4 class="mb-1" style="color: var(--accent-color); font-size: 1.8rem; font-family: 'Orbitron', monospace;">{{ format_time(media.runtime) }}</h4>
                                <p class="mb-0" style="color: var(--text-primary); font-size: 0.9rem; font-weight: 600;">‚è∞ Runtime</p>
                                <small style="color: var(--text-muted); font-size: 0.8rem;">Duration</small>
                            {% elif media.media_type == 'tv' %}
                                <h4 class="mb-1" style="color: var(--accent-color); font-size: 1.8rem; font-family: 'Orbitron', monospace;">{{ media.number_of_seasons or 0 }}</h4>
                                <p class="mb-0" style="color: var(--text-primary); font-size: 0.9rem; font-weight: 600;">üì∫ Seasons</p>
                                <small style="color: var(--text-muted); font-size: 0.8rem;">Total</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Plot Summary -->
                {% if media.overview %}
                <div class="mb-4">
                    <h4 class="glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üìö PLOT SUMMARY</h4>
                    <p class="lead" style="color: var(--text-primary); line-height: 1.7;">{{ media.overview }}</p>
                </div>
                {% endif %}
                
                <!-- Details and Actions -->
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üé≠ DETAILS</h5>
                        <ul class="list-unstyled">
                            {% if media.genres %}
                                <li class="mb-3"><strong style="color: var(--text-primary);">Genres:</strong><br>
                                    {% for genre in media.genres %}
                                        <span class="genre-badge">{{ genre.name }}</span>
                                    {% endfor %}
                                </li>
                            {% endif %}
                            
                            {% if media.original_language %}
                                <li class="mb-2" style="color: var(--text-primary);"><strong>Language:</strong> {{ media.original_language.upper() }}</li>
                            {% endif %}
                            
                            {% if media.media_type == 'movie' %}
                                {% if media.release_date %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>Release Date:</strong> {{ media.release_date }}</li>
                                {% endif %}
                                {% if media.budget and media.budget > 0 %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>Budget:</strong> ${{ "{:,}".format(media.budget) }}</li>
                                {% endif %}
                                {% if media.revenue and media.revenue > 0 %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>Revenue:</strong> ${{ "{:,}".format(media.revenue) }}</li>
                                {% endif %}
                            {% else %}
                                {% if media.first_air_date %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>First Aired:</strong> {{ media.first_air_date }}</li>
                                {% endif %}
                                {% if media.last_air_date %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>Last Aired:</strong> {{ media.last_air_date }}</li>
                                {% endif %}
                                {% if media.status %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>Status:</strong> {{ media.status }}</li>
                                {% endif %}
                                {% if media.number_of_episodes %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>Episodes:</strong> {{ media.number_of_episodes }}</li>
                                {% endif %}
                                {% if media.networks %}
                                    <li class="mb-2" style="color: var(--text-primary);"><strong>Networks:</strong> 
                                        {% for network in media.networks[:2] %}{{ network.name }}{% if not loop.last %}, {% endif %}{% endfor %}
                                    </li>
                                {% endif %}
                            {% endif %}
                        </ul>
                    </div>
                    
                    <div class="col-md-6">
                        <h5 class="glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üîó ACTIONS</h5>
                        <div class="d-grid gap-3">
                            {% if media.media_type == 'movie' and media.runtime %}
                            <a href="/scheduler/movie/{{ media.id }}" class="btn btn-primary-custom">
                                <i class="fas fa-calendar-alt me-2"></i>PLAN VIEWING SCHEDULE
                            </a>
                            {% elif media.media_type == 'tv' %}
                            <a href="/scheduler/tv/{{ media.id }}" class="btn btn-primary-custom">
                                <i class="fas fa-calendar-alt me-2"></i>PLAN VIEWING SCHEDULE
                            </a>
                            {% endif %}
                            
                            <!-- Track Progress Button -->
                            <a href="/progress/{{ media.media_type }}/{{ media.id }}" class="btn btn-success btn-lg">
                                <i class="fas fa-chart-line me-2"></i>TRACK YOUR PROGRESS
                            </a>                         
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Enhanced TV Show Season Analysis -->
        {% if media.media_type == 'tv' and season_data %}
        <div class="card card-custom mt-4">
            <div class="card-header">
                <h5 class="mb-0 glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üì∫ SEASON & EPISODE ANALYSIS</h5>
            </div>
            <div class="card-body">
                <!-- Overview Stats -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h4 style="color: var(--primary-color); font-size: 1.8rem;">{{ media.number_of_seasons or 0 }}</h4>
                            <p style="color: var(--text-primary); font-size: 0.9rem;">SEASONS</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h4 style="color: var(--secondary-color); font-size: 1.8rem;">{{ media.number_of_episodes or 0 }}</h4>
                            <p style="color: var(--text-primary); font-size: 0.9rem;">EPISODES</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h4 style="color: var(--accent-color); font-size: 1.8rem;">{{ format_time(total_runtime) }}</h4>
                            <p style="color: var(--text-primary); font-size: 0.9rem;">TOTAL RUNTIME</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <h4 style="color: var(--warning-color); font-size: 1.8rem;">{{ format_time(total_runtime // (media.number_of_episodes or 1)) }}</h4>
                            <p style="color: var(--text-primary); font-size: 0.9rem;">AVG EPISODE</p>
                        </div>
                    </div>
                </div>
                
                <!-- Enhanced Season Dropdown Analysis -->
                <div class="mb-4">
                    <h6 class="glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üîç VIEW SEASON DETAILS</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label" style="color: var(--text-primary);">Select Season:</label>
                            <select class="form-control season-dropdown" id="seasonSelect" onchange="displaySeasonInfo()"
                                    style="background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary)); 
                                           border: 2px solid var(--primary-color); 
                                           color: var(--text-primary); 
                                           border-radius: 12px; 
                                           padding: 15px 20px; 
                                           font-weight: 600;
                                           box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
                                           transition: all 0.3s ease;">
                                <option value="" style="background: var(--bg-secondary); color: var(--text-primary);">Choose a season...</option>
                                {% for season in season_data %}
                                <option value="{{ season.season_number }}" style="background: var(--bg-secondary); color: var(--text-primary);">
                                    Season {{ season.season_number }} ({{ season.episode_count }} episodes - {{ format_time(season.total_runtime) }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" style="color: var(--text-primary);">Quick Stats:</label>
                            <div id="quickSeasonStats" class="p-3 rounded" 
                                 style="background: linear-gradient(135deg, var(--glass-bg), rgba(79, 70, 229, 0.1)); 
                                        border: 2px solid var(--border-color); 
                                        min-height: 70px; 
                                        border-radius: 12px;
                                        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);">
                                <p class="mb-0 text-center" style="color: var(--text-primary); font-weight: 600;">Select a season to view episode details</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Season Details Container -->
                <div id="seasonDetailsContainer" style="display: none;">
                    <div class="card card-custom">
                        <div class="card-header">
                            <h6 class="mb-0" id="seasonTitle" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">Season Details</h6>
                        </div>
                        <div class="card-body">
                            <div id="seasonContent">
                                <!-- Season content will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Enhanced Videos/Trailers -->
        <div class="card card-custom mt-4">
            <div class="card-header">
                <h5 class="mb-0 glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üé• VIDEOS & TRAILERS</h5>
            </div>
            <div class="card-body">
                {% if media.videos and media.videos.results %}
                    {% set trailers = media.videos.results | selectattr('type', 'equalto', 'Trailer') | selectattr('site', 'equalto', 'YouTube') | list %}
                    {% if trailers %}
                        <div class="ratio ratio-16x9 mb-3" style="border-radius: 15px; overflow: hidden; border: 2px solid var(--border-color);">
                            <iframe src="https://www.youtube.com/embed/{{ trailers[0].key }}" 
                                    title="{{ trailers[0].name }}" allowfullscreen 
                                    style="border-radius: 13px;"></iframe>
                        </div>
                        {% if trailers|length > 1 %}
                            <div class="row">
                                {% for trailer in trailers[1:4] %}
                                <div class="col-md-4 mb-2">
                                    <a href="https://www.youtube.com/watch?v={{ trailer.key }}" 
                                       target="_blank" class="btn btn-outline-primary btn-sm w-100">
                                        <i class="fab fa-youtube me-2"></i>{{ trailer.name[:20] }}{% if trailer.name|length > 20 %}...{% endif %}
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-video fa-4x mb-4" style="color: var(--text-muted);"></i>
                            <h5 style="color: var(--text-primary); font-weight: 600;">No trailers available</h5>
                            <p style="color: var(--text-muted);">Unfortunately, no trailers or videos are currently available for this title.</p>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-video fa-4x mb-4" style="color: var(--text-muted);"></i>
                        <h5 style="color: var(--text-primary); font-weight: 600;">No videos available</h5>
                        <p style="color: var(--text-muted);">No videos or trailers are currently available for this title.</p>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Enhanced Cast & Crew with View All Button -->
        {% if media.credits %}
        <div class="card card-custom mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0 glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üé≠ CAST & CREW</h5>
                <button class="btn btn-outline-primary btn-sm" onclick="showFullCast()">
                    <i class="fas fa-users me-2"></i>VIEW ALL CAST
                </button>
            </div>
            <div class="card-body">
                <!-- Main Cast -->
                {% if media.credits.cast %}
                <h6 class="glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üåü MAIN CAST</h6>
                <div class="row mb-4">
                    {% for actor in media.credits.cast[:8] %}
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="card card-custom h-100">
                            <div class="text-center p-3">
                                {% if actor.profile_path %}
                                    <img src="https://image.tmdb.org/t/p/w185{{ actor.profile_path }}" 
                                         alt="{{ actor.name }}" class="rounded-circle mb-2" 
                                         style="width: 80px; height: 80px; object-fit: cover; border: 3px solid var(--primary-color);">
                                {% else %}
                                    <div class="rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2" 
                                         style="width: 80px; height: 80px; background: var(--glass-bg); border: 3px solid var(--primary-color);">
                                        <i class="fas fa-user text-white fa-2x"></i>
                                    </div>
                                {% endif %}
                                <h6 class="mb-1" style="color: var(--text-primary); font-weight: 600;">{{ actor.name }}</h6>
                                <small style="color: var(--text-secondary); font-weight: 500;">{{ actor.character }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Key Crew -->
                {% if media.credits.crew %}
                {% set key_positions = ['Director', 'Producer', 'Executive Producer', 'Writer', 'Screenplay', 'Music'] %}
                {% set key_crew = {} %}
                {% for person in media.credits.crew %}
                    {% if person.job in key_positions %}
                        {% if person.job not in key_crew %}
                            {% set _ = key_crew.update({person.job: []}) %}
                        {% endif %}
                        {% set _ = key_crew[person.job].append(person.name) %}
                    {% endif %}
                {% endfor %}
                
                {% if key_crew %}
                <h6 class="glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üé¨ KEY CREW</h6>
                <div class="row">
                    {% for position, names in key_crew.items() %}
                    <div class="col-md-6 mb-3">
                        <strong style="color: var(--text-primary);">{{ position }}:</strong> 
                        <span style="color: var(--text-secondary);">{{ names[:3] | join(', ') }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <!-- Recommendations -->
        {% if recommendations or similar %}
        <div class="card card-custom mt-4">
            <div class="card-header">
                <h5 class="mb-0 glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üéØ YOU MIGHT ALSO LIKE</h5>
            </div>
            <div class="card-body">
                {% if recommendations %}
                <h6 class="glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üîÆ RECOMMENDATIONS</h6>
                <div class="row mb-4">
                    {% for item in recommendations %}
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-3">
                        <div class="card card-custom h-100">
                            <div class="poster-container">
                                {% if item.poster_path %}
                                    <img src="https://image.tmdb.org/t/p/w342{{ item.poster_path }}" 
                                         alt="{{ item.title or item.name }}" class="card-img-top">
                                {% else %}
                                    <div class="d-flex align-items-center justify-content-center h-100 bg-secondary text-white">
                                        <i class="fas fa-film fa-2x"></i>
                                    </div>
                                {% endif %}
                                
                                <div class="action-buttons">
                                    <a href="/details/{{ media.media_type }}/{{ item.id }}" 
                                       class="btn btn-sm btn-primary-custom w-100">
                                        <i class="fas fa-eye me-1"></i> VIEW
                                    </a>
                                </div>
                            </div>
                            
                            <div class="card-body p-2">
                                <h6 class="card-title mb-1 small" style="color: var(--text-primary);">{{ (item.title or item.name)[:12] }}{% if (item.title or item.name)|length > 12 %}...{% endif %}</h6>
                                {% if item.vote_average > 0 %}
                                    <small class="rating-badge">‚≠ê {{ "%.1f"|format(item.vote_average) }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Full Cast Modal with Click Positioning -->
<div class="modal fade" id="fullCastModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title glow-text" style="color: var(--text-primary); font-family: 'Orbitron', monospace;">üë• FULL CAST & CREW</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="fullCastContent">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>
</div>

<style>
    /* Loading Spinner Styles */
    .loading-spinner {
        position: relative;
        width: 80px;
        height: 80px;
    }
    
    .spinner-ring {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 4px solid transparent;
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1.5s linear infinite;
    }
    
    .spinner-ring:nth-child(2) {
        border-top-color: var(--secondary-color);
        animation-delay: -0.5s;
        width: 60px;
        height: 60px;
        top: 10px;
        left: 10px;
    }
    
    .spinner-ring:nth-child(3) {
        border-top-color: var(--accent-color);
        animation-delay: -1s;
        width: 40px;
        height: 40px;
        top: 20px;
        left: 20px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Streaming Providers Styles */
    .streaming-providers {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .provider-item {
        display: flex;
        align-items: center;
        background: var(--glass-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 8px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .provider-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        border-color: var(--primary-color);
    }
    
    .provider-logo {
        width: 40px;
        height: 40px;
        border-radius: 6px;
        margin-right: 8px;
        object-fit: cover;
    }
    
    .provider-name {
        color: var(--text-primary);
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    /* Social sharing buttons */
    .social-share {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        flex-wrap: wrap;
    }
    
    .social-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid var(--border-color);
        background: var(--glass-bg);
        color: var(--text-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        cursor: pointer;
    }
    
    .social-btn:hover {
        transform: translateY(-4px) scale(1.1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        color: var(--primary-color);
        border-color: var(--primary-color);
    }
    
    .social-btn.twitter:hover { border-color: #1DA1F2; color: #1DA1F2; }
    .social-btn.facebook:hover { border-color: #4267B2; color: #4267B2; }
    .social-btn.whatsapp:hover { border-color: #25D366; color: #25D366; }
    .social-btn.telegram:hover { border-color: #0088cc; color: #0088cc; }
    .social-btn.copy:hover { border-color: var(--accent-color); color: var(--accent-color); }
    
    /* Quick Add Button Enhancement */
    .quick-add-btn {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 600;
        border-width: 2px;
        position: relative;
        overflow: hidden;
    }
    
    .quick-add-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .quick-add-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
    }
    
    .quick-add-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transition: left 0.5s;
    }
    
    .quick-add-btn:hover::before {
        left: 100%;
    }
    
    /* Season Dropdown Styling */
    .season-dropdown:hover {
        border-color: var(--secondary-color) !important;
        box-shadow: 0 6px 20px rgba(6, 182, 212, 0.3) !important;
        transform: translateY(-2px);
    }
    
    .season-dropdown:focus {
        border-color: var(--accent-color) !important;
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4) !important;
        outline: none;
    }
    
    /* Genre badge styling */
    .genre-badge {
        display: inline-block;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: var(--bg-primary);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin: 2px 4px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* Rating badge styling */
    .rating-badge {
        background: linear-gradient(135deg, var(--warning-color), #ffa500);
        color: var(--bg-primary);
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 0.8rem;
    }
    
    /* Enhanced poster container */
    .poster-container {
        position: relative;
        overflow: hidden;
        border-radius: 15px;
    }
    
    .poster-container img {
        transition: transform 0.3s ease;
    }
    
    .poster-container:hover img {
        transform: scale(1.05);
    }
    
    /* Action buttons overlay */
    .action-buttons {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(transparent, rgba(0,0,0,0.8));
        padding: 20px 10px 10px;
        transform: translateY(100%);
        transition: transform 0.3s ease;
    }
    
    .poster-container:hover .action-buttons {
        transform: translateY(0);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .social-share {
            justify-content: center;
            margin-top: 20px;
        }
        
        .hero-section {
            padding: 40px 20px !important;
            text-align: center;
        }
        
        .stats-card {
            margin-bottom: 15px;
        }
        
        .quick-add-btn {
            font-size: 0.9rem;
        }
        
        .provider-item {
            flex-direction: column;
            text-align: center;
            padding: 10px;
        }
        
        .provider-logo {
            margin-right: 0;
            margin-bottom: 5px;
        }
        
        .provider-name {
            font-size: 0.8rem;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    const mediaData = {{ media|tojson }};
    const seasonData = {{ season_data|tojson if season_data else '[]' }};
    const totalRuntime = {{ total_runtime }};
    let lastClickEvent = null;
    
    // Hide loading overlay once page is loaded
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.opacity = '0';
                setTimeout(() => {
                    loadingOverlay.style.display = 'none';
                }, 500);
            }
        }, 1000);
    });
    
    // Store click events for modal positioning
    document.addEventListener('click', function(e) {
        lastClickEvent = e;
    });
    
    // Quick Add functionality that actually works
    async function quickAddToList(listType, buttonElement) {
        const originalText = buttonElement.dataset.originalText || buttonElement.innerHTML;
        
        // Show loading state
        buttonElement.disabled = true;
        buttonElement.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ADDING...';
        buttonElement.style.opacity = '0.7';
        
        try {
            const response = await fetch('/api/add_to_watchlist', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    media_data: mediaData,
                    list_type: listType,
                    user_rating: 0,
                    notes: ''
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Show success state
                buttonElement.innerHTML = '<i class="fas fa-check me-2"></i>ADDED!';
                buttonElement.className = 'btn btn-success quick-add-btn';
                buttonElement.style.opacity = '1';
                
                showToast(result.message, 'success');
                
                // Reset after 3 seconds
                setTimeout(() => {
                    buttonElement.disabled = false;
                    buttonElement.innerHTML = originalText;
                    
                    // Reset to original button class
                    if (listType === 'want_to_watch') {
                        buttonElement.className = 'btn btn-outline-primary quick-add-btn';
                    } else if (listType === 'watching') {
                        buttonElement.className = 'btn btn-outline-info quick-add-btn';
                    } else if (listType === 'completed') {
                        buttonElement.className = 'btn btn-outline-success quick-add-btn';
                    } else if (listType === 'favorites') {
                        buttonElement.className = 'btn btn-outline-danger quick-add-btn';
                    }
                    
                    buttonElement.style.opacity = '1';
                }, 3000);
            } else {
                // Show error state
                buttonElement.innerHTML = '<i class="fas fa-times me-2"></i>ERROR';
                buttonElement.className = 'btn btn-danger quick-add-btn';
                
                showToast(result.message, 'error');
                
                // Reset after 3 seconds
                setTimeout(() => {
                    buttonElement.disabled = false;
                    buttonElement.innerHTML = originalText;
                    
                    // Reset to original button class
                    if (listType === 'want_to_watch') {
                        buttonElement.className = 'btn btn-outline-primary quick-add-btn';
                    } else if (listType === 'watching') {
                        buttonElement.className = 'btn btn-outline-info quick-add-btn';
                    } else if (listType === 'completed') {
                        buttonElement.className = 'btn btn-outline-success quick-add-btn';
                    } else if (listType === 'favorites') {
                        buttonElement.className = 'btn btn-outline-danger quick-add-btn';
                    }
                    
                    buttonElement.style.opacity = '1';
                }, 3000);
            }
            
        } catch (error) {
            console.error('Error:', error);
            
            // Show error state
            buttonElement.innerHTML = '<i class="fas fa-times me-2"></i>ERROR';
            buttonElement.className = 'btn btn-danger quick-add-btn';
            
            showToast('Error adding to watchlist', 'error');
            
            // Reset after 3 seconds
            setTimeout(() => {
                buttonElement.disabled = false;
                buttonElement.innerHTML = originalText;
                
                // Reset to original button class
                if (listType === 'want_to_watch') {
                    buttonElement.className = 'btn btn-outline-primary quick-add-btn';
                } else if (listType === 'watching') {
                    buttonElement.className = 'btn btn-outline-info quick-add-btn';
                } else if (listType === 'completed') {
                    buttonElement.className = 'btn btn-outline-success quick-add-btn';
                } else if (listType === 'favorites') {
                    buttonElement.className = 'btn btn-outline-danger quick-add-btn';
                }
                
                buttonElement.style.opacity = '1';
            }, 3000);
        }
    }
    
    // Enhanced Season analysis with dropdown functionality
    function displaySeasonInfo() {
        const seasonSelect = document.getElementById('seasonSelect');
        const selectedSeason = parseInt(seasonSelect.value);
        const quickStats = document.getElementById('quickSeasonStats');
        const detailsContainer = document.getElementById('seasonDetailsContainer');
        const seasonTitle = document.getElementById('seasonTitle');
        const seasonContent = document.getElementById('seasonContent');
        
        if (!selectedSeason) {
            quickStats.innerHTML = '<p class="mb-0 text-center" style="color: var(--text-primary); font-weight: 600;">Select a season to view episode details</p>';
            detailsContainer.style.display = 'none';
            return;
        }
        
        const season = seasonData.find(s => s.season_number === selectedSeason);
        if (!season) return;
        
        // Update quick stats with better styling
        quickStats.innerHTML = `
            <div class="row text-center">
                <div class="col-4">
                    <div class="d-flex flex-column align-items-center">
                        <strong style="color: var(--primary-color); font-size: 1.4rem; font-family: 'Orbitron', monospace;">${season.episode_count}</strong>
                        <small style="color: var(--text-primary); font-weight: 600; font-size: 0.8rem; text-transform: uppercase;">Episodes</small>
                    </div>
                </div>
                <div class="col-4">
                    <div class="d-flex flex-column align-items-center">
                        <strong style="color: var(--secondary-color); font-size: 1.4rem; font-family: 'Orbitron', monospace;">${formatTime(season.total_runtime)}</strong>
                        <small style="color: var(--text-primary); font-weight: 600; font-size: 0.8rem; text-transform: uppercase;">Total Runtime</small>
                    </div>
                </div>
                <div class="col-4">
                    <div class="d-flex flex-column align-items-center">
                        <strong style="color: var(--accent-color); font-size: 1.4rem; font-family: 'Orbitron', monospace;">${formatTime(Math.round(season.average_runtime))}</strong>
                        <small style="color: var(--text-primary); font-weight: 600; font-size: 0.8rem; text-transform: uppercase;">Avg Length</small>
                    </div>
                </div>
            </div>
        `;
        
        // Update season details with EXACT episode timings
        seasonTitle.textContent = `üì∫ Season ${selectedSeason} Episodes`;
        seasonTitle.style.color = 'var(--text-primary)';
        
        if (season.episodes && season.episodes.length > 0) {
            const episodeCards = season.episodes.map((ep, index) => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card card-custom h-100" style="animation-delay: ${index * 50}ms;">
                        <div class="card-body p-3">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="mb-0" style="color: var(--primary-color); font-family: 'Orbitron', monospace; font-weight: 700;">E${ep.episode_number}</h6>
                                <span class="badge" style="background: linear-gradient(135deg, var(--secondary-color), var(--accent-color)); color: var(--bg-primary); font-weight: 700; font-size: 11px;">
                                    ${ep.runtime ? formatTime(ep.runtime) : 'N/A'}
                                </span>
                            </div>
                            <h6 class="mb-2" style="color: var(--text-primary); font-weight: 600; line-height: 1.3;">${ep.name || 'Episode ' + ep.episode_number}</h6>
                            ${ep.air_date ? `<small style="color: var(--text-secondary); font-weight: 500;"><i class="fas fa-calendar-alt me-1"></i>${ep.air_date}</small>` : ''}
                            ${ep.overview ? `<p class="small mt-2 mb-0" style="color: var(--text-muted); line-height: 1.4;">${ep.overview.substring(0, 120)}${ep.overview.length > 120 ? '...' : ''}</p>` : ''}
                            ${ep.vote_average > 0 ? `<small class="mt-2 d-block" style="color: var(--warning-color); font-weight: 600;"><i class="fas fa-star me-1"></i>${ep.vote_average.toFixed(1)}/10</small>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            seasonContent.innerHTML = `
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h4 style="color: var(--primary-color); font-size: 1.8rem;">${season.episode_count}</h4>
                            <p style="color: var(--text-primary); font-size: 0.9rem;">EPISODES</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h4 style="color: var(--secondary-color); font-size: 1.8rem;">${formatTime(season.total_runtime)}</h4>
                            <p style="color: var(--text-primary); font-size: 0.9rem;">TOTAL TIME</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h4 style="color: var(--accent-color); font-size: 1.8rem;">${formatTime(Math.round(season.average_runtime))}</h4>
                            <p style="color: var(--text-primary); font-size: 0.9rem;">AVG EPISODE</p>
                        </div>
                    </div>
                </div>
                <h6 class="glow-text mb-3" style="color: var(--text-primary); font-family: 'Orbitron', monospace; text-transform: uppercase; letter-spacing: 1px;">üìã EPISODE LIST WITH EXACT TIMINGS</h6>
                <div class="row">
                    ${episodeCards}
                </div>
            `;
        } else {
            seasonContent.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-tv fa-4x mb-4" style="color: var(--text-muted);"></i>
                    <h5 style="color: var(--text-primary); font-weight: 600;">Episode details not available</h5>
                    <p style="color: var(--text-muted);">This season's episode information is currently unavailable.</p>
                </div>
            `;
        }
        
        detailsContainer.style.display = 'block';
        
        // Animate episode cards
        setTimeout(() => {
            const episodeCards = detailsContainer.querySelectorAll('.card-custom');
            episodeCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }, 100);
        
        detailsContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    
    // Enhanced Full cast modal with click positioning
    function showFullCast() {
        const modal = document.getElementById('fullCastModal');
        const content = document.getElementById('fullCastContent');
        
        // Position modal at click location if available
        if (lastClickEvent) {
            positionModalAtClick(modal, lastClickEvent);
        }
        
        if (mediaData.credits && mediaData.credits.cast) {
            const castHtml = mediaData.credits.cast.map((actor, index) => `
                <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-3" style="animation-delay: ${index * 30}ms;">
                    <div class="card card-custom h-100">
                        <div class="text-center p-3">
                            ${actor.profile_path ? 
                                `<img src="https://image.tmdb.org/t/p/w185${actor.profile_path}" 
                                     alt="${actor.name}" class="rounded-circle mb-2" 
                                     style="width: 80px; height: 80px; object-fit: cover; border: 3px solid var(--primary-color);">` :
                                `<div class="rounded-circle d-flex align-items-center justify-content-center mx-auto mb-2" 
                                     style="width: 80px; height: 80px; background: var(--glass-bg); border: 3px solid var(--primary-color);">
                                    <i class="fas fa-user text-white fa-2x"></i>
                                </div>`
                            }
                            <h6 class="mb-1" style="color: var(--text-primary); font-weight: 600; font-size: 0.9rem;">${actor.name}</h6>
                            <small style="color: var(--text-secondary); font-weight: 500;">${actor.character}</small>
                        </div>
                    </div>
                </div>
            `).join('');
            
            content.innerHTML = `
                <h6 class="glow-text mb-4 text-center" style="color: var(--text-primary); font-family: 'Orbitron', monospace; text-transform: uppercase; letter-spacing: 1px;">üåü COMPLETE CAST</h6>
                <div class="row">
                    ${castHtml}
                </div>
            `;
        } else {
            content.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-users fa-5x mb-4" style="color: var(--text-muted);"></i>
                    <h5 style="color: var(--text-primary); font-weight: 600;">Cast information not available</h5>
                    <p style="color: var(--text-muted);">Cast details are currently unavailable for this title.</p>
                </div>
            `;
        }
        
        // Show modal
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();
        
        // Animate cast cards
        modal.addEventListener('shown.bs.modal', function() {
            const castCards = content.querySelectorAll('.card-custom');
            castCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 50);
            });
        });
    }
    
    // Modal positioning function
    function positionModalAtClick(modal, clickEvent) {
        if (!clickEvent) return;
        
        const modalDialog = modal.querySelector('.modal-dialog');
        if (!modalDialog) return;
        
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const modalWidth = 800; // Approximate modal width
        const modalHeight = 600; // Approximate modal height
        
        let x = clickEvent.clientX;
        let y = clickEvent.clientY;
        
        // Adjust if modal would go off screen
        if (x + modalWidth > viewportWidth) {
            x = viewportWidth - modalWidth - 20;
        }
        if (y + modalHeight > viewportHeight) {
            y = viewportHeight - modalHeight - 20;
        }
        
        // Ensure minimum margins
        x = Math.max(20, x);
        y = Math.max(20, y);
        
        modalDialog.style.position = 'fixed';
        modalDialog.style.left = x + 'px';
        modalDialog.style.top = y + 'px';
        modalDialog.style.margin = '0';
        modalDialog.style.transform = 'none';
    }
    
    // Social sharing functions
    function shareContent(platform) {
        const title = mediaData.title || mediaData.name;
        const year = (mediaData.release_date || mediaData.first_air_date || '').substring(0, 4);
        const shareTitle = `${title} ${year ? `(${year})` : ''} - Check this out on FlixTracker!`;
        const shareUrl = window.location.href;
        
        let shareLink = '';
        
        switch(platform) {
            case 'twitter':
                shareLink = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareTitle)}&url=${encodeURIComponent(shareUrl)}`;
                break;
            case 'facebook':
                shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
                break;
            case 'whatsapp':
                shareLink = `https://wa.me/?text=${encodeURIComponent(shareTitle + ' ' + shareUrl)}`;
                break;
            case 'telegram':
                shareLink = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareTitle)}`;
                break;
        }
        
        if (shareLink) {
            window.open(shareLink, '_blank', 'width=600,height=400');
        }
    }
    
    function copyLink() {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            showToast('Link copied to clipboard!', 'success');
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = url;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast('Link copied to clipboard!', 'success');
        });
    }
    
    // Helper function for time formatting
    function formatTime(minutes) {
        if (!minutes || minutes <= 0) return '0m';
        
        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        
        if (hours > 0) {
            return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
        } else {
            return `${mins}m`;
        }
    }
    
    // Enhanced utility functions for toast notifications
    function showToast(message, type = 'info') {
        // Create toast if it doesn't exist
        let toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toast-container';
            toastContainer.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                max-width: 400px;
                pointer-events: none;
            `;
            document.body.appendChild(toastContainer);
        }
        
        const toast = document.createElement('div');
        toast.className = `toast-notification toast-${type}`;
        
        const colors = {
            success: '#28a745',
            error: '#dc3545',
            warning: '#ffc107',
            info: '#17a2b8'
        };
        
        const icons = {
            success: 'fas fa-check-circle',
            error: 'fas fa-exclamation-circle',
            warning: 'fas fa-exclamation-triangle',
            info: 'fas fa-info-circle'
        };
        
        toast.style.cssText = `
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 16px 20px;
            border-radius: 8px;
            border-left: 4px solid ${colors[type]};
            margin-bottom: 10px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            pointer-events: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 100%;
            word-wrap: break-word;
        `;
        
        toast.innerHTML = `
            <i class="${icons[type]}" style="color: ${colors[type]}; flex-shrink: 0;"></i>
            <span style="flex: 1;">${message}</span>
            <button onclick="this.parentElement.remove()" style="
                background: none;
                border: none;
                color: #ccc;
                cursor: pointer;
                padding: 0;
                margin-left: 10px;
                font-size: 18px;
                flex-shrink: 0;
            ">√ó</button>
        `;
        
        toastContainer.appendChild(toast);
        
        // Animate in
        setTimeout(() => {
            toast.style.transform = 'translateX(0)';
        }, 100);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (toast.parentElement) {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 300);
            }
        }, 5000);
    }
    
    // Initialize and setup functions
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Details page loaded with media:', mediaData);
        
        // Store original button text for all quick add buttons
        const quickAddButtons = document.querySelectorAll('.quick-add-btn');
        quickAddButtons.forEach(button => {
            if (!button.dataset.originalText) {
                button.dataset.originalText = button.innerHTML;
            }
        });
        
        // Initialize card animations
        const cards = document.querySelectorAll('.card-custom');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 100}ms`;
            card.classList.add('animate-in');
        });
        
        // Initialize social button hover effects
        const socialBtns = document.querySelectorAll('.social-btn');
        socialBtns.forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px) scale(1.1)';
            });
            
            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
        
        // Make functions globally available
        window.quickAddToList = quickAddToList;
        window.displaySeasonInfo = displaySeasonInfo;
        window.showFullCast = showFullCast;
        window.shareContent = shareContent;
        window.copyLink = copyLink;
    });
</script>
{% endblock %}